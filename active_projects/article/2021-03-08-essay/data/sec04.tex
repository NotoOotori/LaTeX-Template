% !TeX root = ../main.tex

\section{代数与几何的联系}\label{sec:algebraandgeometry}

不加说明的情况下$k$依然指代数闭域.

\subsection{理想与代数集}

这一节我们将讨论仿射空间与射影空间的代数集与多项式环的理想的对应关系.

先考虑仿射空间$\AF^n$的情况, 记$A\coloneq \kk [X_1, \dotsc, X_n]$. 对于多项式环$A$的子集$T$, 我们已经定义了$T$的零点集$Z(T)\subseteq\AF^n$. 同样地, 对于仿射空间的子集$Y$, 我们也可以定义$Y$的\emph{理想}为在$Y$上取值为零的多项式全体, 即$I(Y)\coloneq \{f\in A\vert f(x)=0, \forall x\in Y\}$, $I(Y)$一定是环$A$的理想, 并且如果$Y$为单点集, 则$I(Y)$为极大理想.

\begin{proposition}[{{\parencite[3, Proposition 1.2; 4, Corollary 1.4]{hartshorne_algebraic_1977}}}]\label{prop:affinegaloisconnectionclosedradical}
  设$Y, Y_1, Y_2$为$\AF^n$的子集, $T, T_1, T_2$为$A$的子集, $\ideal{a}$为$A$的理想, 则
  \begin{enumerate}
    \item\label{enum:prop-affine-galois-connection-closed-radical-1} $Z(T)=Z((T))=Z(\sqrt{(T)})$;
    \item\label{enum:prop-affine-galois-connection-closed-radical-2} 如果$T_1\subseteq T_2$, 那么$Z(T_1)\supseteq Z(T_2)$;
    \item\label{enum:prop-affine-galois-connection-closed-radical-3} $I(Y)=I(\overline{Y})$;
    \item\label{enum:prop-affine-galois-connection-closed-radical-4} 如果$Y_1\subseteq Y_2$, 那么$I(Y_1)\supseteq I(Y_2)$;
    \item\label{enum:prop-affine-galois-connection-closed-radical-5} $I(Y_1\cup Y_2)=I(Y_1)\cap I(Y_2)$;
    \item\label{enum:prop-affine-galois-connection-closed-radical-nullstellensatz} (强Hilbert零点定理\parencite[85, Exercise 14]{atiyah_introduction_1969}) $I(Z(\ideal{a}))=\sqrt{a}$;
    \item\label{enum:prop-affine-galois-connection-closed-radical-closure} $Z(I(Y))=\overline{Y}$;
    \item\label{enum:prop-affine-galois-connection-closed-radical-8} 如果$\ideal{p}$是$A$的素理想, 那么$Z(\ideal{p})$是$\AF^n$的不可约闭集;
    \item\label{enum:prop-affine-galois-connection-closed-radical-9} 如果$Y$是$\AF^n$的不可约闭集, 那么$I(Y)$是$A$的素理想.
  \end{enumerate}
  于是由$Z$和$I$, 我们可以建立$\AF^n$的代数集全体与$A$的根理想之间的反序双射, 将$\AF^n$的不可约闭集对应到$A$的素理想.
\end{proposition}

\begin{proof}
  这里我们只证明\ref{enum:prop-affine-galois-connection-closed-radical-nullstellensatz}\ref{enum:prop-affine-galois-connection-closed-radical-closure}\ref{enum:prop-affine-galois-connection-closed-radical-8}和\ref{enum:prop-affine-galois-connection-closed-radical-9}.

  \ref{enum:prop-affine-galois-connection-closed-radical-nullstellensatz} 根据\ref{enum:prop-affine-galois-connection-closed-radical-1}\ref{enum:prop-affine-galois-connection-closed-radical-2}和\ref{enum:prop-affine-galois-connection-closed-radical-4}知$I(Z(\ideal{a}))\supseteq\sqrt{\ideal{a}}$. 反过来, 假设$f\notin\sqrt{\ideal{a}}$, 根据\thref{prop:scheinnullstellensatz}知存在包含$\ideal{a}$的素理想$\ideal{p}$使得$f\notin\ideal{p}$. 设$B=(A{\divslash}\ideal{p})$, $C=B_{f}=B[1{\divslash}f]$, 则$C$为有限生成$\kk$-代数. 设$\ideal{m}$为$C$的一个极大理想, 则根据\thref{thm:hilbert-nullstellensatz-weak}知$D\coloneq C{\divslash}\ideal{m}\cong\kk$. 设$X_j\in A$在$D$的像为$x_j$, 则我们定义了一个点$x=(x_1, \dotsc, x_n)\in \AF^n$, 并且有$g\in A$在$D$的像为在$g(x)$. 于是我们有$x\in Z(\ideal{a})$但是$f(x)\neq 0$.

  \ref{enum:prop-affine-galois-connection-closed-radical-closure} 根据定义有$Y\subseteq Z(I(Y))$, 而右边是闭集, 所以有$\overline{Y}\subseteq Z(I(Y))$. 反过来, 假设$W$为包含$Y$的闭子集, 则存在$A$的理想$\ideal{a}$使$W=Z(\ideal{a})$. 因此$Z(\ideal{a})\supseteq Y$, 再根据\ref{enum:prop-affine-galois-connection-closed-radical-3}得$I(Z(\ideal{a}))\subseteq I(Y)$. 又$\ideal{a}\subseteq I(Z(\ideal{a}))$, 因此由\ref{enum:prop-affine-galois-connection-closed-radical-2}有$W=Z(\ideal{a})\supseteq Z(I(Y))$. 故$Z(I(Y))=\overline{Y}$.

  \ref{enum:prop-affine-galois-connection-closed-radical-8} 设有闭集$Y_1$和$Y_2$使得$Z(\ideal{p})=Y_1\cup Y_2$, 则由\ref{enum:prop-affine-galois-connection-closed-radical-4}和\ref{enum:prop-affine-galois-connection-closed-radical-nullstellensatz}知$\ideal{p}=I(Y_1)\cap I(Y_2)$, 由\thref{prop:prime}\ref{enum:prop-prime-absorb}知$\ideal{p}=I(Y_1)$或者$\ideal{p}=I(Y_2)$, 故由\ref{enum:prop-affine-galois-connection-closed-radical-closure}得$Z(\ideal{p})=Y_1$或$Z(\ideal{p})=Y_2$, 这就证明了$Z(\ideal{p})$是不可约集.

  \ref{enum:prop-affine-galois-connection-closed-radical-9} 设$fg\in I(Y)$, 则由\thref{prop:affinezariskitopology}\ref{enum:prop-affine-zariski-topology-2}知$Y=(Y\cap Z(f))\cup (Y\cap Z(g))$, 因为$Y$是不可约闭集, 所以$Y\subseteq Z(f)$或者$Y\subseteq Z(g)$, 故$f\in I(Y)$或者$g\in I(Y)$.
\end{proof}

再考虑射影空间$\PP^n$的情形, 记$S\coloneq \kk [X_0, \dotsc, X_n]$, $S$的齐次多项式全体为$\Shomo$, 次数为$d$的齐次多项式全体为$S_d$, $S_+=\sum_{d>0}S_d$为$S$的一个极大理想. 对于$\Shomo$的子集$T$, 我们已经定义了$T$的零点集$Z(T)\subseteq\PP^n$. 同样地, 对于仿射空间的子集$Y$, 我们也可以定义$Y$的\emph{理想}为在$Y$上取值为零的齐次多项式全体生成的理想.

\begin{proposition}[{{\parencite[11, Exercise 2.1--2.4]{hartshorne_algebraic_1977}}}]\label{prop:projectivegaloisconnectionclosedradical}
  设$Y, Y_1, Y_2$为$\PP^n$的子集, $T, T_1, T_2$为$\Shomo$的子集, $\ideal{a}$为$S$的齐次理想, 则
  \begin{enumerate}
    \item\label{enum:prop-projective-galois-connection-closed-radical-1} $Z(T)=Z((T))=Z(\sqrt{(T)})$;
    \item\label{enum:prop-projective-galois-connection-closed-radical-2} 如果$T_1\subseteq T_2$, 那么$Z(T_1)\supseteq Z(T_2)$;
    \item\label{enum:prop-projective-galois-connection-closed-radical-3} $I(Y)=I(\overline{Y})$;
    \item\label{enum:prop-projective-galois-connection-closed-radical-4} 如果$Y_1\subseteq Y_2$, 那么$I(Y_1)\supseteq I(Y_2)$;
    \item\label{enum:prop-projective-galois-connection-closed-radical-5} $I(Y_1\cup Y_2)=I(Y_1)\cap I(Y_2)$;
    \item 下列三个条件等价.
    \begin{enumerate}
      \item $Z(\ideal{a})=\varnothing$;
      \item $\sqrt{\ideal{a}}$等于$S$或$S_+$;
      \item 对于某个$d>0$有$\ideal{a}\supseteq S_d$;
    \end{enumerate}
    \item\label{enum:prop-projective-galois-connection-closed-radical-nullstellensatz} 如果$Z(\ideal{a})\neq\varnothing$, 则$I(Z(\ideal{a}))=\sqrt{a}$;
    \item\label{enum:prop-projective-galois-connection-closed-radical-closure} $Z(I(Y))=\overline{Y}$;
    \item\label{enum:prop-projective-galois-connection-closed-radical-8} 如果$\ideal{p}$是$S$的齐次素理想且$\ideal{p}\neq S_+$, 那么$Z(\ideal{p})$是$\PP^n$的不可约闭集;
    \item\label{enum:prop-projective-galois-connection-closed-radical-9} 如果$Y$是$\PP^n$的不可约闭集, 那么$I(Y)$是$S$的素理想且$I(Y)\neq S_+$.
  \end{enumerate}
  于是由$Z$和$I$, 我们可以建立$\PP^n$的代数集全体与$S$的不同于$S_+$的齐次根理想之间的反序双射, 将$\PP^n$的不可约闭集对应到$S$的不同于$S_+$的齐次素理想. 因为$S_+$不出现在这个对应中, 有时也称$S_+$为\emph{无关极大理想}.
\end{proposition}

\begin{proof}
  只证\ref{enum:prop-projective-galois-connection-closed-radical-nullstellensatz}. 考虑$I(Z(\ideal{a}))\subseteq\ideal{a}$的情况. $\ideal{a}$也可以看成$n+1$维仿射空间$\AF^{n+1}$的多项式环$A=\kk [X_0, \dotsc, X_n]$的理想, 记$\ideal{a}$在$\AF^{n+1}$的零点集为$Y$. 考虑齐次多项式$f\in \Shomo$满足$f$在$Z(\ideal{a})\subseteq \PP^n$上均为0, 因为$Z(\ideal{a})\neq 0$且$f=0$的情况平凡, 不妨假设$f$的次数大于0, 则$f$看成$\AF^{n+1}$上的函数在$Y$上均为0, 由\thref{prop:affinegaloisconnectionclosedradical}\ref{enum:prop-affine-galois-connection-closed-radical-nullstellensatz}知$f\in\sqrt{\ideal{a}}$.
\end{proof}

% 射影空间
% 函数环的刻画
\subsection{函数环}\label{subsec:ag-functionrings}

这一节中我们要定义仿射空间代数集的仿射坐标环, 以及射影空间中代数集的射影坐标环, 并研究它们与代数簇上的整体函数环, 在某点的局部环以及函数域的关系.

如果$Y\subseteq \AF^n$是仿射空间中的代数集, 若将$A$中元素看作为$Y$上的函数, 则$A$在由函数相等定义的等价关系下的商环即为$A(Y)\coloneq A{\divslash}I(Y)$, 称为$Y$的\emph{仿射坐标环}. 如果$Y$是仿射代数簇, 则$A(Y)$也为多项式函数整环.

现在我们可以来仔细考察仿射代数簇上定义的环与放射坐标环之间的关系, 并将代数的分式环理论\ref{subsec:algebra-localization}和维数理论\ref{subsec:algebra-dimension}应用到几何的研究中.

\begin{theorem}[{{\parencite[6, Proposition 1.7; 17, Theorem 3.2]{hartshorne_algebraic_1977}}}]\label{thm:affinerings}
  设$Y\subseteq \AF^n$为仿射代数簇, 其仿射坐标环为$A(Y)$, 则
  \begin{enumerate}
    \item\label{enum:thm-affine-rings-1} $\dim (Y)=\dim A(Y)$;
    \item\label{enum:thm-affine-rings-2} $\OO (Y)\cong A(Y)$, 于是$A(Y)$为同构不变量;
    \item\label{enum:thm-affine-rings-3} 对于每个点$P\in Y$, 令$\ideal{m}_P\subseteq A(Y)$为在$P$点取值为零的坐标函数全体所构成的极大理想, 则$P\mapsto \ideal{m}_P$给出了$Y$到$A(Y)$的极大理想全体之间的双射;
    \item\label{enum:thm-affine-rings-4} 对于每个点$P$, 都有$\OO_P\cong A(Y)_{\ideal{m}_P}$, 并且$\dim \OO_P=\dim Y$;
    \item\label{enum:thm-affine-rings-5} $K(Y)$同构于$A(Y)$的分式域, 于是$K(Y)$是$\kk$的有限域扩张, 超越次数等于$\dim (Y)$.
  \end{enumerate}
\end{theorem}

\begin{proof}
  根据\thref{prop:affinegaloisconnectionclosedradical}知$Y$的不可约闭子集全体到$A$的包含$I(Y)$的素理想全体之间有反序双射, 故由\thref{prop:quotidealcorr}知到$A(Y)$的素理想全体之间也有反序双射. 因此$Y$的不可约闭子集降链与$A(Y)$的素理想升链之间有保长度的双射, 于是由\thref{thm:ringdim}知$\dim (Y)=\dim (A(Y))$, \ref{enum:thm-affine-rings-1}得证.

  因为每个$A$的元素都能看成$Y$上的正规函数, 于是有同态$A\to \OO (Y)$, 又这个同态的核恰为$I(Y)$, 于是我们有单同态$\alpha\colon A(Y)\to \OO (Y)$.

  利用\thref{prop:quotidealcorr}我们知道$Y$与$A$中包含$I(Y)$的极大理想全体之间存在双射, 即与$A(Y)$的极大理想全体之间存在一一对应. 利用上述定义的$\alpha$将$A(Y)$的元素看作$Y$上的正规函数, 我们有点$P$对应的极大理想即为$\ideal{m}_{P}=\{f\in A(Y)\vert f(P)=0\}$, 故\ref{enum:thm-affine-rings-3}得证.

  对于每个$P\in Y$, 将$\OO (Y)$看作$\OO_P$的子环, 我们可以得到单同态$A(Y)\to \OO_P$, 这个同态将每个$\ideal{m}_P$外的元素都映到单位, 于是我们可以得到单同态$A(Y)_{\ideal{m}_{P}}\to \OO_P$. 根据正规函数的定义, 正规函数在局部上可以写成两个多项式的商, 其中分母在局部没有零点, 于是有这个同态也是满射, 因此$A(Y)_{\ideal{m}_P}\cong \OO_P$. 因为$\OO_P$是整环, 对$\ideal{p}=(0)\subseteq \OO_P$利用\thref{thm:ringdim}和\thref{prop:fracideal}\ref{enum:prop-fracideal-2}可得$\dim \OO_P$等于极大理想$\ideal{m}_P$在$A(Y)$的高度$h(\ideal{m}_P)$. 又因为$A(Y){\divslash}\ideal{m}_P\cong \kk$, 即$\codim (\ideal{m}_P)=0$, 故利用\ref{enum:thm-affine-rings-1}和\thref{thm:ringdim}知$h(\ideal{m}_P)=\dim A(Y)=\dim (Y)$, 于是$\dim (\OO_P)=\dim (Y)$, \ref{enum:thm-affine-rings-4}得证.

  根据\ref{enum:thm-affine-rings-3}和\thref{prop:multilocalization}, 对于每个$P\in Y$都有分式域$K(A(Y))\cong K(A(Y)_{\ideal{m}_P})\cong K(\OO_P)$. 因为典范单同态$\OO_P\to K(Y)$诱导出的映射$\amalg_{P\in Y}\OO_P\to K(Y)$是满射, 即每个有理函数都能看成某个$\OO_Y$中的元素, 因此对于每个$P$都有$K(\OO_P)\cong K(Y)$, 故$K(A(Y))\cong K(Y)$. 因为$A(Y)$是有限生成$\kk$-代数, 所以$K(Y)\cong K(A(Y))$是$\kk$的有限域扩张, 并且根据域的多项式函数整环维数的定义, 有$\dim (Y)$即为域扩张的超越次数, \ref{enum:thm-affine-rings-5}得证.

  最后, 利用\ref{enum:thm-affine-rings-3}和\ref{enum:thm-affine-rings-4}, 并将每个环都看成分式域$K(Y)$的子环, 我们有$A(Y)\subseteq\OO (Y)\subseteq \bigcap_{\ideal{m}} A(Y)_{\ideal{m}}$. 而\thref{prop:integraldomainlocalizationintersection}证明了$\bigcap_{\ideal{m}} A(Y)_{\ideal{m}}= A(Y)$, 因此我们有$A(Y)\cong \OO(Y)$, 这证明了\ref{enum:thm-affine-rings-2}.
\end{proof}

与仿射情形类似, 如果$Y\subseteq \PP^n$是射影空间中的代数集, 定义$Y$的\emph{射影坐标环}$S(Y)\coloneq S{\divslash}I(Y)$.

\begin{theorem}[{{\parencite[11--12, Exercise 2.6; 18, Theorem 3.4]{hartshorne_algebraic_1977}}}]\label{thm:projectiverings}
  设$Y\subseteq\PP^n$为射影代数簇, 其齐次射影坐标环为$S(Y)$, 则
  \begin{enumerate}
    \item\label{enum:thm-projective-rings-1} $\dim (S(Y))=\dim (Y)+1$;
    \item\label{enum:thm-projective-rings-2} $\OO (Y)\cong\kk$;
    \item\label{enum:thm-projective-rings-3} 对于每个点$P\in Y$, 令$\ideal{m}_P\subseteq S(Y)$为在$P$点取值为零的齐次坐标函数所生成的极大理想, 则$\OO_P\cong S(Y)_{(\ideal{m}_P)}$;
    \item\label{enum:thm-projective-rings-4} $K(Y)\cong S(Y)_{(0)}$.
  \end{enumerate}
\end{theorem}

\begin{proof}
  首先, 设$U_j\subseteq\PP^n$是由$X_j\neq 0$所定义的开集, 记$Y_j=Y\cap U_j$, 则由\thref{prop:projectiveopencoverisomorphism}知$\varphi_j$诱导出$Y_j$与$\AF^n$的某个仿射代数簇的同构. 有$S(Y)_{X_j}$同构于$A(Y_j)[X_j, X_j^{-1}]$, 通过计算域扩张的次数以及利用\thref{thm:affinerings}\ref{enum:thm-affine-rings-1}, 有$\dim (S(Y))=\dim (S(Y)_{X_j})=\dim (A(Y_j)[X_j, X_j^{-1}])=\dim (A(Y))+1=\dim (Y)+1$. 这证明了\ref{enum:thm-projective-rings-1}.

  我们现在来构造仿射坐标环$A(Y_j)$与$S(Y)_{(X_j)}$之间的同构. 首先如\thref{prop:projspaceopencoverhomeo}中那样构造$\kk [Y_1, \dotsc, Y_n]$到$\kk [X_0, \dotsc, X_n]_{(X_j)}$的同构, 将$f$映到$f(X_0{\divslash}X_j, \dotsc, X_{j-1}{\divslash}X_j, X_{j+1}{\divslash}X_j, \dotsc, X_n{\divslash}X_j)$. 通过验证多项式的零点可以证明这个同构将$I(Y_j)$映到$I(Y)S_{(X_j)}$, 于是我们得到了同构$\varphi_j^*\colon A(Y_j)\cong S(Y)_{(X_j)}$.

  设$P\in Y$为任意点, 存在$j$使得$P\in Y_j$, 记$\ideal{m}_P'$为$P$在$A(Y_j)$中对应的极大理想. 由\thref{thm:affinerings}\ref{enum:thm-affine-rings-4}可得$\OO_P\cong A(Y_j)_{\ideal{m}_P'}$. 通过验证多项式的零点可以证明$\varphi_{j}^*(\ideal{m}_P')=\ideal{m}_PS(Y)_{(X_j)}$. 因为$X_j\notin \ideal{m}_P$, 再根据\thref{prop:multilocalization}可得$A(Y_j)_{\ideal{m}_P'}\cong S(Y)_{\ideal{m}_P}$. 这证明了\ref{enum:thm-projective-rings-3}.

  类似地, 由\thref{thm:affinerings}\ref{enum:thm-affine-rings-5}可得$K(Y)\cong K(Y_j)$同构于$A(Y_j)$的分式域, 再由$\varphi_j^*$得同构于$S(Y)_{(0)}$. 这证明了\ref{enum:thm-projective-rings-4}.

  最后, 设$f\in\OO (Y)$是整体的正规函数, 于是对于每个$j$都有$f$在$Y_j$上正规, 于是根据\thref{thm:affinerings}\ref{enum:thm-affine-rings-2}可以认为$f\in A(Y_j)$, 又由$\varphi_j^*$知$A(Y_j)\cong S(Y)_{(X_j)}$, 于是$f$可以写成$g_j{\divslash}X_j^{N_j}$的形式, 其中$g_j\in S(Y)$为$N_j$次的齐次多项式. 因为$S(Y)$是整环, 所以可以将$\OO (Y), K(Y), S(Y)$都看作$S(Y)$的分式域$L$的子环, 于是$X_j^{N_j}f\in S(Y)_{N_j}$, 其中$S(Y)_{N_j}$表示齐次环$S(Y)$中次数为$N_j$的齐次元全体. 取$N\geq \sum N_j$, 则$S(Y)_N$作为$\kk$-线性空间可以由次数为$N$的由$X_0, \dotsc, X_n$构成的单项式生成, 根据鸽笼原理知$f\cdot S(Y)_N\subseteq S(Y)_N$, 迭代即得对于每个$q>0$都有$f^q\cdot S(Y)_N$. 特别地, 取$X_j\notin I(Y)$, 则有对于每个$q>0$都有$X_0^Nf^q\in S(Y)$. 于是子环$S(Y)[f]\subseteq L$包含于$X_0^{-N}S(Y)$中, 而$X_0^{-N}S(Y)$是有限生成$S(Y)$-模, 又因为$S(Y)$是Noether环, 所以由\thref{prop:fgmoduleovernoetherring}和\thref{prop:noethermodule}得$S(Y)[f]$是有限生成$S(Y)$-模, 于是由\thref{prop:integraldependence}知$f$为$S(Y)$的整元, 又因为$f$的次数为零, 故存在$x_1, \dotsc, x_m\in S(Y)\cong \kk$使得$f^m+x_1f^{m-1}+\dotsb +x_m=0$成立. 于是$f$是$\kk$的代数元, 又$\kk$是代数闭域, 于是有$f\in \kk$, 这证明了\ref{enum:thm-projective-rings-1}.
\end{proof}

\begin{theorem}[{{\parencite[19, Proposition 3.5]{hartshorne_algebraic_1977}}}]\label{thm:categoryisoaffinevariety}
  设$X$是任意的代数簇, $Y$是仿射代数簇, 则存在$X, Y$之间的态射全体到$A(Y), \OO (X)$之间的$k$-代数同态全体的双射,
  \begin{equation*}
    \alpha\colon \Hom (X, Y)\to\Hom (A(Y), \OO (X)),
  \end{equation*}
  并且下图中定义的反变函子
  \begin{equation*}
    \begin{tikzcd}[sep=small]
      X \arrow[dd, "\varphi"'] & \mapsto & A(X)\\
      & \mapsto & \\
      Y & \mapsto & A(Y) \arrow[uu, "\alpha (\varphi)"']
    \end{tikzcd}
  \end{equation*}
  给出了$k$的仿射代数簇范畴与$k$的多项式函数整环范畴(态射为$\kk$-代数同态)的反变范畴等价.
\end{theorem}

\begin{proof}
  先来给出$\alpha$的定义. 因为每个态射$\varphi\colon X\to Y$可以通过复合将$Y$上的正规函数对应到$X$上的正规函数, 于是$\varphi$诱导了$\OO (Y)$到$\OO (X)$的$\kk$-代数同态. 又由\thref{thm:affinerings}\ref{enum:thm-affine-rings-2}知有$k$-代数同构$\OO (Y)\cong A(Y)$, 故每个$\varphi$对应到了一个$A(Y)$到$\OO (X)$的$\kk$-代数同态, 于是我们得到了$\alpha$.

  反过来, 如果给定了$\kk$-代数同态$h\colon A(Y)\to \OO (X)$, 我们来构造态射$X\to Y$. 将$Y$嵌入到某个$\AF^n$中, 假设$Y$为$\AF^n$的不可约闭子集, 于是$A(Y)=\kk [X_1, \dotsc, X_n]{\divslash} I(Y)$. 记$X_j\in \OO (Y)\cong A(Y)$为单项式$X_j\in A$所诱导的$Y$上的正规函数. 考虑$\xi_j=h(X_j)\in \OO (X)$, 是$X$上的正规函数, 于是我们可以定义$\psi\colon X\to \AF^n$将$P\in X$映到$(\xi_1 (P), \dotsc, \xi_n (P))\in \AF^n$.

  现在证明$\Im (\psi)\subseteq Y$. 只需要证明对于$P\in X$以及$f\in I(Y)$有$f(\psi(P))=0$. 而因为$f$是多项式, $f\in I(Y)$, 并且$h$是代数同态, 所以$f(\psi(P))=f(\xi_1(P), \dotsc, \xi_n(P))=h(f(X_1, \dotsc, X_n))(P)=0$, 故得证$\psi$是$X$到$Y$的映射.

  由\thref{prop:morphismtoaffinevariety}得上述构造的$\psi$是态射, 又由定义可得$\alpha(\varphi)$对应的$\psi$即为$\varphi$, 故得证$\alpha$是双射.

  最后证明范畴等价. 函子性由构造可显然得出, 并且我们已经证明了这个函子是完全忠实的, 又因为每个$k$的多项式函数整环都可以写成某个$k$的代数簇的仿射坐标环, 因此这个函子也是本质满射的, 于是由\thref{thm:categoryequivalence}知这个函子给出了范畴之间的等价.
\end{proof}

\thref{thm:categoryisoaffinevariety}给出了与仿射代数簇范畴等价的代数范畴, 利用这个事实, 我们可以证明每个代数簇在局部上都能找到仿射开子集. 继而我们可以证明代数簇以控制有理映射作为态射的范畴与有限生成域扩张的范畴有反变范畴等价. 如果一个代数簇同构于某个仿射代数簇, 则称它是\emph{仿射的}.

\begin{proposition}[{{\parencite[25, Lemma 4.2]{hartshorne_algebraic_1977}}}]\label{prop:hypersurfaceaffine}
  设$f\in A\coloneq \kk [X_1, \dotsc, X_n]$, 设$Y=Z(f)$为$\AF^n$中由$f=0$定义的超曲面, 则$\AF^n-Y$同构于$\AF^{n+1}$中由$X_{n+1}f=1$定义的超曲面$H$. 特别地, $\AF^n$是仿射的, 并且仿射坐标环为$\kk [X_1, \dotsc, X_n]_{f}$.
\end{proposition}

\begin{proof}
  对于$P=(x_1, \dotsc, x_{n+1})\in H$, 定义$\varphi (P)=(x_1, \dotsc, x_n)$, 则$\varphi$是从$H$到$\AF^n - Y$的态射, 并且为双射. 观察到$\varphi^{-1}(x_1, \dotsc, x_n)\in (x_1, \dotsc, x_n, 1{\dotsb} f(x_1, \dotsc, x_n))$, 因此由\thref{prop:morphismtoaffinevariety}得$\varphi^{-1}$也是态射.
\end{proof}

\begin{proposition}[{{\parencite[25, Proposition 4.3]{hartshorne_algebraic_1977}}}]\label{prop:affinetopologicalbasis}
  代数簇$Y$上有由仿射开子集构成的拓扑基.
\end{proposition}

\begin{proof}
  因为$Y$的开子集也是代数簇, 并且由\thref{prop:projectiveopencoverisomorphism}知每个代数簇都可以写成拟仿射代数簇的并, 所以我们只需要对任意拟仿射代数簇$Y\subseteq \AF^n$证明对于任意的$P\in Y$都有包含$P$的仿射开子集$U\subseteq Y$. 取$f\in Z(\overline{Y}-Y)$, 考虑超曲面$H\coloneq Z(f)$, 可以定义$U\coloneq (\AF^n-H )\cap Y= (\AF^n -H)\cap \overline{Y}$, 则$P\in U$, 并且$U$即是$\AF^n$的开子集, 又是$\AF^n -H$的闭子集, 由\thref{prop:hypersurfaceaffine}知$U$即为想要得到的仿射开子集.
\end{proof}

\begin{theorem}[{{\parencite[25, Theorem 4.4]{hartshorne_algebraic_1977}}}]
  设$X, Y$是任意的代数簇, 则存在$X, Y$之间的控制有理映射全体到$K(Y), K(X)$之间的$\kk$-代数同态全体的双射$\beta$, 并且下图中定义的反变函子
  \begin{equation*}
    \begin{tikzcd}[sep=small]
      X \arrow[dd, "\varphi"'] & \mapsto & K(X)\\
      & \mapsto & \\
      Y & \mapsto & K(Y) \arrow[uu, "\beta (\varphi)"']
    \end{tikzcd}
  \end{equation*}
  给出了$k$的代数簇范畴(态射为控制有理映射)与$k$的有限生成域扩张范畴(态射为$\kk$-代数同态)的反变范畴等价.
\end{theorem}

\begin{proof}
  先来给出$\beta$的定义. 设控制有理映射$\varphi\colon X\to Y$可以由$\lrbig<>{U, \varphi_U}$表示, 设$\lrbig<>{V, f}\in K(Y)$, 则定义$\beta(\varphi)=\lrbig<>{\varphi_{U}^{-1}(V), f\composite \varphi_U}$. 因为$\varphi$是控制有理映射, 所以$\varphi_{U}^{-1}(V)$是非空开集, 并且$f\composite \varphi_U$定义了$\varphi_{U}^{-1}(V)$上的有理映射.

  反过来, 如果$\theta\colon K(Y)\to K(X)$是$\kk$-代数同态, 我们来构造控制有理映射$X\to Y$. 由\thref{prop:affinetopologicalbasis}, 不妨假设$Y$是仿射的, 仿射坐标环为$A(Y)$是$A\coloneq \kk [Y_1, \dotsc, Y_n]$的商环. 因为$\theta(Y_1), \dotsc, \theta(Y_n)$是$X$上的有理函数, 所以存在非空开集$U\subseteq X$使得每个$\theta(Y_j)$是正规函数. 由于域之间的环同态一定是单射, 所以$\theta$可以定义$k$-代数单同态$A(Y)\to \OO (U)$, 而由\thref{thm:categoryisoaffinevariety}知这给出了态射$\varphi\colon U\to Y$. 根据构造, $f\in\Ker (A(Y)\to \OO (U))$当且仅当$f(\overline{\varphi (U)})=0$, 因而$\Ker (A(Y)\to \OO (U))=0$当且仅当$\overline{\Im (\varphi)}=Y$\footfullcite{e_defining_2017}, 于是我们得到了控制有理映射$X\colon Y$. 不难验证我们由此给出了$\beta$的逆.

  最后证明范畴等价. 因为一个代数簇的有理函数域等于某个仿射开子集的有理函数域, 故为$k$的多项式函数整环的分式域, 故为$k$的有限生成域扩张. 又不难由构造证明函子性, 故由\thref{thm:categoryequivalence}知还需要证明每个$k$的有限生成域扩张$K$都可以写成某个代数簇的分式域. 设$K=\kk (x_1, \dotsc, x_n)$, 则$B=\kk [x_1, \dotsc, x_n]$是多项式函数整环, 为某个仿射代数簇的仿射坐标环, 并且$B$的分式域即为$K$, 故得证.
\end{proof}

\subsection{杂项}

% 交理论 准素分解 维数理论
% 准素分解 代数里面有重数 几何里面有直观
% Zariski Vol I P241 Theorem 30, 31
% AM P69 Exercise 5.16
% Hartshorne Ex 2.6
% Hartshorne Exm II.2.4 embedded points

\subsection{概形}\label{subsec:ag-affinescheme}

现代代数几何的主要语言从固定域上的代数簇发展到了概形. 概形这个概念是簇及其上的函数环的推广, 对于给定的代数闭域可以构造从簇范畴到概形范畴的完全忠实函子, 并且利用概形的语言我们可以对更一般更本质的对象进行研究, 可以允许局部环内有幂零元, 可以考察在基域的变换下对象的变换等等. 这一节中我们将要引入层的语言, 介绍仿射概形的定义及基本性质, 并简单叙述概形的定义及概形之间的态射.

回顾在\ref{subsec:algebra-category}我们定义了拓扑空间$X$上集合取值的预层是函子$F\colon \cat{Top}(X)^{\op}\to\cat{Set}$. 为了更符合直觉, 这一节中我们考虑的都是Abel群取值的预层, 为函子$\sheaf{F}\colon \cat{Top}(X)^{\op}\to\cat{Ab}$, 注意$\sheaf{F}(\varnothing)=0$为平凡Abel群. 称$\sheaf{F}(U)$中的元素为$\sheaf{F}$在$U$上的\emph{截面}, 有时也记$\sheaf{F}(U)$为$\Gamma (U, \sheaf{F})$. 称映射$\rho_{UV}\coloneq \sheaf{F}(U\to V)$为\emph{限制映射}, 对于$s\in \sheaf{F}(U)$有时也记$\rho_{UV}(s)$为$s\restrict{V}$.

大体上说一个层就是可以由局部信息决定的预层. 利用范畴论的语言, 对于Abel群取值的预层$\sheaf{F}$, 定义由$U_\lambda\subseteq U$构成的开集族$\{U_\lambda\}$\emph{覆盖}$U$如果它们及其两两的交以及所有可能的态射所定义的$\cat{Top}(X)$中的图的上极限为$U$, 如果$\sheaf{F}$保持这些上极限, 则称$\sheaf{F}$是\emph{层}. 显式地说, 如果预层$\sheaf{F}$满足对于任意的开集$U$和任意$U$的开覆盖$\{V_\lambda\}$都有
\begin{enumerate}
  \item 如果$s\in\sheaf{F}$满足对于每个$\lambda$都有$s\restrict{V_{\lambda}}=0$, 就有$s=0$;
  \item 如果存在一族截面$\{s_\lambda\in\sheaf{F(V_\lambda)}\}$满足任两个截面在其交上的限制相等, 则存在$s\in\sheaf{F(U)}$使得对于任意的$\lambda$都有$s\restrict{V_\lambda}=s_{\lambda}$;
\end{enumerate}
则$\sheaf{F}$是层.

如果$\sheaf{F}$是拓扑空间$X$上的预层, 设$P$为$X$的一点, 则包含$P$点的开集全体所对应的Abel群的直极限称为$P$点处的\emph{茎}, 记为$\sheaf{F}_P$, 称自然映射$\sheaf{F}(U)\to \sheaf{F}_P$将截面$s$映到$P$点处的\emph{芽}.

\begin{example}
  在\ref{subsec:ag-functionrings}中我们定义了代数簇上的整体函数环与任一点处的局部环, 其实这定义了代数簇上的环值的层结构. $\sheaf{F}(U)\coloneq\OO (U)$定义为$U$上的正规函数全体, $\sheaf{F}(U\to V)$定义为包含映射$\OO (V)\to \OO(U)$, 则$\sheaf{F}$是层, 并且在$P$点处的茎即为局部环$\OO_P$. 称$\OO$为仿射簇上的\emph{正规函数层}.
\end{example}

既然预层被定义为函子, 那么很自然预层之间的态射被定义为函子之间的自然变换, 层之间的态射也被定义为函子之间的自然变换. 下面一个命题阐释了层的结构可以由它的局部性质决定.

\begin{proposition}[{{\parencite[63, Theorem 1.1]{hartshorne_algebraic_1977}}}]
  设$\varphi\colon \sheaf{F}\to\sheaf{G}$是拓扑空间$X$上的两个层之间的态射, 则$\varphi$是同构当且仅当在每个点$P$处诱导的茎之间的映射$\varphi_P\colon \sheaf{F}_P\to\sheaf{G}_P$是同构.
\end{proposition}

\begin{proof}
  $\Rightarrow$显然. 对于$\Leftarrow$, 只需要证明每个$\varphi (U)\colon \sheaf{F}(U)\to\sheaf{G}(U)$是双射即可. 因为$\varphi(s)\restrict{U}=0$蕴含着在每个局部$U_P$有$\varphi(s)\restrict{U_P}=0$, 故为单射. 另一方面, 对于$t\in \sheaf{G}(U)$, 再利用茎上的满射可以在每个点的某个局部$U_P$上构造截面$s(P)$使得$\varphi(s(P))=t\restrict{U_P}$, 并利用之前证明的单射可以将局部的截面$s(P)$拼成整体的截面$s$, 并有$\varphi(s)=t$.
\end{proof}

\begin{proposition}[{{\parencite[64, Proposition-Definition 1.2]{hartshorne_algebraic_1977}}}]
  给定拓扑空间$X$, 设$\sheaf{F}$为其上的预层, 记$X$上的预层全体关于之前所定义的态射所构成的范畴为$\cat{Presheaf}$, 则函子$\cat{Presheaf}(\sheaf{F}, -)\colon \cat{Sheaf}\to \cat{Set}$是可表函子, 记泛对象为$\sheaf{F}^+$, 称为预层$\sheaf{F}$\emph{对应的层}.
\end{proposition}

\begin{proof}
  只叙述$\sheaf{F}^+$的构造. 对于开集$U$, 定义$\sheaf{F}^+(U)$为函数$s\colon U\to \bigcup_{P\in U}\sheaf{F}_P$全体, 并且对于每个$P\in U$, 这些函数被要求满足
  \begin{enumerate}
    \item $s(P)\in\sheaf{F}_P$;
    \item 存在$P$的邻域$V\subseteq U$和元素$t\in \sheaf{F}(V)$满足对于任意的$Q\in V$, 芽$t_Q=s(Q)$.
  \end{enumerate}
\end{proof}

我们还可以讨论底拓扑空间变化的情况下层结构的变化. 设$f\colon X\to Y$是拓扑空间之间的连续映射, 对于任意$X$上的层$\sheaf{F}$, 定义其在$Y$上的\emph{像层}$f_*\sheaf{F}$满足$(f_*\sheaf{F})(V)=\sheaf{F}(f^{-1}(V))$. 对于$Y$上的层$\sheaf{G}$, 定义其在$X$上的\emph{原像层}$f^{-1}\sheaf{G}$为预层$U\mapsto\dlim \sheaf{G}(V)$对应的层, 其中直极限是对所有的包含$f(U)$的开集$V\subseteq Y$来取的. 特别地, 对于$X$的子空间$Z$, 我们可以利用包含映射定义$X$上的层$\sheaf{G}$在$Z$上的\emph{限制}, 通常记为$\sheaf{F}\restrict{Z}$. 注意$\sheaf{F}\restrict{Z}$在每个点$P$处的茎即为$\sheaf{F}_P$.

\bigskip

现在可以来重新考察环的素谱这一概念. \ref{subsec:algebra-primespec}中我们已经定义了素谱上的Zariski拓扑, 现在我们再在其上定义环值的层结构, 使其具有类似于仿射簇的结构.

设$A$为环, $\Spec (A)$为其素谱, 我们来定义层$\sheaf{O}\colon \cat{Top}(\Spec (A))\to \cat{Ring}$. 对于每个开集$U\subseteq \Spec (A)$, 定义$\sheaf{O}(U)$为在局部能写成$A$的元素之商的函数$s\colon U\to \amalg_{\ideal{p}\in U}A_{\ideal{p}}$全体构成的环. 不难验证$\sheaf{O}(U)$是环, 以及$\sheaf{O}$是层. 现在默认环的素谱上也赋有刚才所定义的层结构.

我们发现环的素谱有类似于仿射簇上的正规函数层的性质, 并且从素谱可以重新构造出原本的环. 回顾记号$\Spec(A)_{f}$表示闭集$V((f))$的余集.

\begin{proposition}[{{\parencite[71, Proposition 2.2]{hartshorne_algebraic_1977}}}]\label{prop:primespectrumsheaf}
  设$A$为环, $(\Spec (A), \OO)$为其素谱, 则
  \begin{enumerate}
    \item\label{enum:prop-prime-spectrum-sheaf-1} 对于任意的$\ideal{p}\in\Spec (A)$, 层$\OO$的茎$\OO_P$同构于局部环$A_{\ideal{p}}$;
    \item\label{enum:prop-prime-spectrum-sheaf-2} 对于任意的元素$f\in A$, 环$\OO(\Spec (A)_f)$同构于局部化环$A_f$. 特别地, $\OO (\Spec (A))\cong A$.
  \end{enumerate}
\end{proposition}

\begin{proof}
  \ref{enum:prop-prime-spectrum-sheaf-1} 利用直极限的定义可以构造同态$\varphi\colon \OO_{\ideal{p}}\to A_{\ideal{p}}$, 将$\ideal{p}$点邻域的截面$s$映到$s(\ideal{p})\in A_{\ideal{p}}$. 对于每个$a{\divslash}f\in A_{\ideal{p}}$, 则存在$s\in\OO (\Spec (A))_f$使得对于任意的$\ideal{q}\in \OO (\Spec (A))_f$都有$s(\ideal{q})=a{\divslash}f$, 因此$\varphi$为满射. 又如果截面$s$使得$s(\ideal{p})=0$, 则在邻域$U'$有$s(\ideal{q})=a{\divslash}f$, 因此存在$x\in A-\ideal{p}$使得$ax=0$. 则$s$在开集$\Spec (A)_x\cap U'$上的限制为零, 因此$\varphi$为单射.

  \ref{enum:prop-prime-spectrum-sheaf-2} 定义$\psi\colon A_f\to \OO (\Spec (A)_f)$将$a{\divslash}f^n$映到截面$s\in \OO (\Spec (A)_f)$, $s$将每个$\ideal{p}$都映到$a{\divslash}f^n$. 首先, 如果$\psi(a{\divslash}f^n)=0$, 则可以推出$V(\Ann a)\cap \Spec (A)_f=\varnothing$, 于是$f^ma=0$, 故$\psi$为单射. 另一方面, 设$s\in \OO (\Spec (A)_f)$, 先证明$\Spec (A)_f$可以由开子集$D(h_j)$覆盖, 并且$s$在$D(h_j)$上可以由$a_j{\divslash}h_j$表示. 再利用$\Spec (A)$的拓扑基的拟紧性, 可以假设这些$D(h_j)$是有限的. 接着利用上述表述的在交集处的相容性, 可以不妨假设对于任意的$j,k$都有$h_ka_j=h_ja_k$. 最后对于$f^n=\sum b_jh_j$构造$a=\sum b_ja_j$, 则在$\Spec (A)_{h_j}$上有$a{\divslash}f^n=a_j{\divslash}h_j$, 因此$\psi (a{\divslash}f^n)=s$, 得证$\psi$为满射.
\end{proof}

为了定义素谱之间的态射, 我们需要引入赋环空间的概念. \emph{赋环空间}包含的信息为一个拓扑空间$X$和$X$上的一个环值的层$\OO_X$. 两个赋环空间$(X, \OO_X)$和$(Y, \OO_Y)$之间的\emph{态射}包含的信息为连续映射$f\colon X\to Y$和层态射$f^\mathoctothorpe\colon \OO_Y\to f_*\OO_X$. 如果赋环空间$(X, \OO_X)$满足对于每个$P\in X$都有茎$\OO_{X, P}$是局部环, 则称其为\emph{局部赋环空间}. 局部赋环空间之间的\emph{态射}为赋环空间之间的态射$(f, f^\mathoctothorpe)$, 额外要求在每个点$P\in X$处诱导映射
\begin{equation*}
  f^\mathoctothorpe_P\colon \OO_{Y, f(P)}=\dlim \OO_Y(V)\to \dlim\OO_X (f^{-1}V) \to \OO_{X, P}
\end{equation*}
是局部环之间的\emph{局部同态}, 即满足值域的唯一极大理想的原像是定义域的极大理想.

\begin{propositionnoproof}[{{\parencite[71, Proposition 2.2]{hartshorne_algebraic_1977}}}]
  素谱定义了环范畴到局部赋环空间范畴之间的完全反变函子.
\end{propositionnoproof}

现在终于可以来定义概形这个概念了. 定义\emph{仿射概形}是局部赋环空间$(X, \OO_X)$, 并且同构于某个环的素谱. 定义\emph{概形}是局部赋环空间$(X, \OO_X)$, 并且满足每个点处都有邻域$U$使得子拓扑空间$U$以及限制层$\OO_X\restrict{U}$是仿射概形. 称$X$为\emph{底拓扑空间}, 通常用$X$表示整个概型的结构, 而用$\sp (X)$表示它的拓扑空间结构. 概形之间的态射即为局部赋环空间之间的态射.

如果存在概形态射$f\colon X\to S$, 则称$f$是$S$\emph{上的概形}, 特别地, 如果$S=\Spec (A)$, 也称$f$是$A$\emph{上的概型}. 如果概形之间的态射$f\colon X\to Y$满足存在$Y$的仿射开覆盖$V_j=\Spec (B_j)$使得对于每个$j$, $f^{-1}(V_j)$都可以被有限个仿射开子集$U_{jk}=\Spec (A_{jk})$覆盖, 并且每个$A_{jk}$都是有限生成$B_j$-代数, 则称$f$为\emph{有限类型的}. 特别地, 如果有有限类型的态射$f\colon X\to \Spec (\kk)$, 则称$X$是$\kk$上的\emph{有限类型的概形}. $S$上的概形之间的态射自然被要求要与给定的到$S$的态射可交换.

我们可以证明, 对于代数闭域$\kk$, 存在从$\kk$上的簇范畴到$\kk$上的概形范畴的完全忠实函子$t$, 并且对于每个簇$V$, 它的拓扑空间结构同胚于$\sp (t(V))$的闭点全体所构成的子空间, 并且$V$的正规函数层可以通过这个同胚由$t(V)$的结构层的限制所得到\parencite[78, Proposition 2.6]{hartshorne_algebraic_1977}.

% locally ringed space
% 仿射概形
% 是不是来个例子 比如说k[x]
% 没有范畴嵌入 是不是仿射簇同构于其素谱拓扑空间的闭点所构成的子空间
% 没有新的范畴同构 有个范畴等价 https://mathoverflow.net/questions/157973/classical-algebraic-varieties-vs-k-schemes-vs-schemes
% finite type P84
% 这件事情我们就先不管了 https://math.stackexchange.com/a/241695

% 极大谱和仿射空间同胚 更一般地 我们有
% \thref{thm:affinerings}
% 准素分解 孤立 嵌入 似乎不太适合在这里 但可以说一下两个定理证明的类似之处

\subsection{代数群与Hopf代数}

% Hartshorne Ex 3.21 Group Variety (Algebraic Group)
% Basic examples
% affine algebraic groups
% Hopf algebra
